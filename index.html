<!DOCTYPE html>
<html>
<style>
  body {
    padding: 50px;
    width: 1200px;
    margin: auto;
    text-align: left;
    font-weight: 300;
    font-family:  "Helvetica Neue", Helvetica;
    color:#383838;
    font-size: 20px;
    line-height: 1.5;
  }
  table.center {
  margin-left:auto;
  margin-right:auto;
}
</style>
<p style="font-family: helvetica">

<h1 id="proj1">CS 194-26 Computer Vision & Computational Photography</h1>
<h2 id="subtitle">Programming Project 3: Facial Keypoint Detection with Neural Networks</h2>
<h2 id="subtitle">By Alek Petuskey</h2>
<h2 id="overview">Overview</h2>
<p> For the first part, I used the IMM Face Database for training an initial toy model for nose tip detection. Addtionally, I expanded on this model to detect 58
facial keypoints/landmarks using the same dataset. Finally, I extrapolated on facial detection by using ibug face in the wild dataset for training a facial keypoints
detector.</p>
<h2 id="overview">Part 1: Nose Tip Detection</h2>
<p> In this section of the project I used 4 convolutional layers. I had varying channel and kernal sizes in each layer.
The channel sizes being 12, 16, 16, and 32 while the coresponding kernal sizes were 7x7, 5,x5 5x5, and 3x3. This was followed by 2 fully connected layers where
a ReLU was applied to the first. I initially set the learning rate to be 1e-3 but found  1e-4 to be better. Overall the program was good a picking nose point of straight on faces.
It struggled with finding faces that were pointed to the side.  The person it struggled the most with was a bald male. This may be because most of the other people
in the dataset were not bald and the absense of hair may not of had enough people to trian with.</p>
<table style="width:50%" class="center">
  <tr><th> <img src="fullnose.png" alt="drawing" width="800"/><th> </tr>
</table>
<h2 id="overview">Average MSE Loss Training & Validation vs Iteration</h2>
<table style="width:50%" class="center">
  <tr><th> <img src="norseiter.png" alt="drawing" width="1000"/><th> </tr>
</table>
<h2 id="overview">Best and Worst Nose Detection</h2>
<table style="width:50%" class="center">
  <tr><th> <img src="download.png" alt="drawing" width="600"/><th> </tr>
</table>



<h2 id="overview">Part 2: Full Facial Keypoints Detection</h2>
<p> I now expanded the CNN to detect 58 facial keypoints/landmarks using the same dataset as part 1.
Through trial and error I determined the best learning rate for my CNN to be .001.</p>
<table style="width:50%" class="center">
  <tr><th> <img src="net.png" alt="drawing" width="600"/><th> </tr>
</table>
<p> Here is an a visual example of the 1st, 3rd, and 5th layers of my CNN</p>
<table style="width:50%" class="center">
  <tr><th> <img src="conv1.png" alt="drawing" width="300"/><th>
  <img src="conv2.png" alt="drawing" width="300"/><th> <th>
  <img src="conv3.png" alt="drawing" width="300"/><th> </tr>
</table>

<h2 id="overview">Dataloader</h2>
<table style="width:50%" class="center">
  <tr><th> <img src="p.png" alt="drawing" width="600"/><th>
  <img src="p1.png" alt="drawing" width="600"/><th> </tr>
</table>
<h2 id="overview">Average MSE Loss Training & Validation vs Iteration</h2>
<table style="width:50%" class="center">
  <tr><th> <img src="part2loss.png" alt="drawing" width="800"/><th> </tr>
</table>

<h2 id="overview">Best and Worst Face Detection</h2>
<p> Here are some of the examples of the better facial detections.</p>
<table style="width:50%" class="center">
  <tr><th> <img src="g1.png" alt="drawing" width="300"/><th>
  <img src="g2.png" alt="drawing" width="300"/><th> <th>
  <img src="g3.png" alt="drawing" width="300"/><th> </tr>
</table>
<p> Here are some of the examples of the faces that struggled to be detected correctly. I noticed in all these photos there are some irregularitites from the normal face in the dataset.
For example the two men had facial hair which could mask key features. Additionally the womans hood may have thrown some features off.</p>
<table style="width:50%" class="center">
  <tr><th> <img src="b1.png" alt="drawing" width="300"/><th>
  <img src="b2.png" alt="drawing" width="300"/><th> <th>
  <img src="b3.png" alt="drawing" width="300"/><th> </tr>
</table>

<h2 id="overview">Part 3: Train With Larger Dataset</h2>
<p> CNN Model In this part, I used a predefined model Resnet18, which has the following architecture seen in the picture below.</p>
<table style="width:50%" class="center">
  <tr><th> <img src="net3.jpg" alt="drawing" width="1000"/><th> </tr>
</table>
<p>I changed conv1's first input to be 1, since we use grayscale images
  I also changed the number of output class to be 68 * 2, which are the x, y
  coordinates of each facial point. I had the kernal size as 7x7, stride as 2x2, and padding at 3x3.
  I came in 7th in the competition with an score of
7.398. Here is the losss curve of the first 20 epoches. In the competition I used around 46 epoches in
total.</p>
<h2 id="overview">Average MSE Loss Training & Validation vs Iteration</h2>
<table style="width:50%" class="center">
  <tr><th> <img src="p3loss.png" alt="drawing" width="800"/><th>
</table>

<h2 id="overview">Dataloader</h2>
<table style="width:50%" class="center">
  <tr><th> <img src="Unknown-1.png" alt="drawing" width="300"/><th>
  <img src="Unknown-2.png" alt="drawing" width="300"/><th> <th>
  <img src="Unknown-7.png" alt="drawing" width="300"/><th> </tr>
</table>
<h2 id="overview">Results Test Set</h2>


<table style="width:50%" class="center">
  <tr><th> <img src="Unknown-10.png" alt="drawing" width="300"/><th>
  <img src="Unknown-9.png" alt="drawing" width="300"/><th> <th>
  <img src="Unknown-11.png" alt="drawing" width="300"/><th> </tr>
</table>

<table style="width:50%" class="center">
  <tr><th> <img src="Unknown-12.png" alt="drawing" width="300"/><th>
  <img src="Unknown-13.png" alt="drawing" width="300"/><th> <th>
  <img src="Unknown-14.png" alt="drawing" width="300"/><th> </tr>
</table>
<h2 id="overview">Results My Choices</h2>
<p>Overall my results were fairly good. One example of Resnet18 struggling was with that bald man
making a funny face. The other two example sof my choosing did fairly well.</p>
<table style="width:50%" class="center">
  <tr><th> <img src="Unknown-6.png" alt="drawing" width="300"/><th>
  <img src="Unknown-4.png" alt="drawing" width="300"/><th> <th>
  <img src="Unknown-5.png" alt="drawing" width="300"/><th> </tr>
</table>

<p></p>
<p></p>
</html>
